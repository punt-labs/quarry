{
  "permissions": {
    "allow": [
      "Bash(pdfinfo:*)",
      "Bash(pdftotext:*)",
      "Bash(pdfimages:*)",
      "WebFetch(domain:docs.lancedb.com)",
      "Bash(git config:*)",
      "Bash(grep:*)",
      "Bash(ls:*)",
      "Bash(aws s3api head-bucket:*)",
      "Bash(uv sync:*)",
      "Bash(uv run ruff check:*)",
      "Bash(uv run ruff format:*)",
      "Bash(uv run mypy:*)",
      "Bash(uv run python:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(uv run pytest:*)",
      "Bash(uv run:*)",
      "Bash(uv pip install:*)",
      "Bash(git status:*)",
      "mcp__ocr-search__search_documents",
      "mcp__ocr-search__get_page",
      "Bash(git log:*)",
      "Bash(bd:*)",
      "Bash(git remote add:*)",
      "Bash(git remote set-url:*)",
      "Bash(git push:*)",
      "Bash(git mv:*)",
      "Bash(find:*)",
      "Bash(claude mcp list:*)",
      "Bash(claude mcp remove:*)",
      "Bash(claude mcp add:*)",
      "mcp__quarry__get_documents",
      "Bash(git checkout:*)",
      "Bash(git merge feature/delete-and-status-tools --no-ff -m \"$\\(cat <<''EOF''\nMerge feature/delete-and-status-tools\n\nAdd delete_document MCP tool + CLI command, status MCP tool,\nSQL injection fix, CHANGELOG.md. 71 tests passing.\n\nCloses: ocr-k7h, ocr-cdv\nEOF\n\\)\")",
      "Bash(git branch:*)",
      "Bash(git merge:*)",
      "Bash(python3:*)",
      "mcp__quarry__ingest",
      "mcp__quarry__status",
      "mcp__quarry__search_documents",
      "Bash(uv build:*)",
      "Bash(uvx twine check:*)",
      "Bash(git rm:*)",
      "Bash(test:*)",
      "Bash(uvx twine upload:*)",
      "Bash(uv venv:*)",
      "Bash(/tmp/quarry-test/bin/pip install:*)",
      "Bash(/tmp/quarry-test/bin/quarry:*)",
      "Bash(/tmp/quarry-test/bin/python:*)",
      "Bash(uvx quarry-mcp:*)",
      "Bash(gh release create:*)",
      "Bash(gh run list:*)",
      "Bash(gh run view:*)",
      "Bash(claude mcp inspect:*)",
      "WebFetch(domain:lancedb.github.io)",
      "WebFetch(domain:lancedb.com)",
      "WebFetch(domain:blog.lancedb.com)",
      "Bash(wc:*)",
      "Bash(git -C /Users/jfreeman/Coding/ocr status)",
      "Bash(git -C /Users/jfreeman/Coding/ocr log --oneline -5)",
      "Bash(git -C /Users/jfreeman/Coding/ocr add pyproject.toml)",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\nAdd pytest slow marker for integration tests\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git -C /Users/jfreeman/Coding/ocr add:*)",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\nAdd integration test fixtures and shared conftest\n\nStatic text fixtures for photosynthesis, French Revolution, quantum\ncomputing, Markdown guide, and LaTeX calculus. Session-scoped conftest\nfixtures for embedding model warmup, Settings, LanceDB, and generated\nbinary files \\(PDF, DOCX, PNG\\).\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\nAdd 21 end-to-end integration tests\n\nTests the full ingest-chunk-embed-store-search pipeline with real\nembedding model and real LanceDB. Covers text files, Markdown, LaTeX,\nPDF, DOCX, raw text ingestion, collection isolation, collection\nderivation, overwrite behavior, and multi-document search ranking.\nImage OCR test requires AWS credentials \\(skipped without\\).\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git -C /Users/jfreeman/Coding/ocr push)",
      "Bash(git -C /Users/jfreeman/Coding/ocr log --oneline -20)",
      "Bash(git stash:*)",
      "Bash(gh pr create --title \"Add directory registry and incremental sync\" --body \"$\\(cat <<''EOF''\n## Summary\n\n- **SQLite registry** \\(`registry.py`\\) tracks directories and ingested files with mtime+size for delta detection\n- **Sync engine** \\(`sync.py`\\) discovers files, computes change plans, and ingests new/changed files in parallel via `ThreadPoolExecutor`\n- **Exponential backoff** for Textract polling \\(5s â†’ 30s cap, 1.5x multiplier\\) reduces API calls ~3x for long OCR jobs\n- **CLI commands**: `register`, `deregister`, `registrations`, `sync`\n- **MCP tools**: `register_directory`, `deregister_directory`, `list_registrations`, `sync_all_registrations`; `status\\(\\)` now includes registration count\n\n## New modules\n\n| Module | Lines | Purpose |\n|--------|-------|---------|\n| `src/quarry/registry.py` | 206 | SQLite registry with WAL mode, directory and file record CRUD |\n| `src/quarry/sync.py` | 219 | File discovery, delta detection \\(`SyncPlan`\\), parallel sync engine |\n| `tests/test_registry.py` | 214 | 17 tests for registry operations |\n| `tests/test_sync.py` | 316 | 15 tests for discovery, delta detection, sync engine |\n\n## Test plan\n\n- [x] 243 unit tests pass \\(`uv run pytest --ignore=tests/integration`\\)\n- [x] Zero ruff lint violations\n- [x] Zero mypy type errors\n- [ ] Manual: `quarry register /path/to/dir --collection name`\n- [ ] Manual: `quarry registrations`\n- [ ] Manual: `quarry sync`\n- [ ] Manual: `quarry deregister name`\n\nðŸ¤– Generated with [Claude Code]\\(https://claude.com/claude-code\\)\nEOF\n\\)\")",
      "Bash(gh pr checks:*)",
      "Bash(gh pr view:*)",
      "Bash(gh api:*)",
      "Bash(git -C /Users/jfreeman/Coding/ocr diff --stat)",
      "Bash(git -C /Users/jfreeman/Coding/ocr diff -- src/ tests/)",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\nFix 3 PR review issues: document_name propagation, register errors, sync JSON\n\nThread document_name through ocr_document_via_s3 and extract_text_pages\nso sync''s relative-path naming reaches PageContent construction.\n\nReplace raw IntegrityError from register_directory with targeted\nValueError messages distinguishing duplicate directory from duplicate\ncollection.\n\nReturn pure JSON from sync_all_registrations with progress as a\nstructured array field instead of mixed text+JSON.\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\nFix register_directory docstring: IntegrityError â†’ ValueError\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(gh pr merge:*)",
      "Bash(git -C /Users/jfreeman/Coding/ocr checkout main)",
      "Bash(git -C /Users/jfreeman/Coding/ocr pull)",
      "Bash(git -C /Users/jfreeman/Coding/ocr branch:*)",
      "Bash(git -C /Users/jfreeman/Coding/ocr tag:*)",
      "Bash(gh release list:*)",
      "Bash(gh release view:*)",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\nBump version to 0.2.0 for directory registration and sync release\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git -C /Users/jfreeman/Coding/ocr push --tags)",
      "Bash(uv publish:*)",
      "Bash(uv lock:*)",
      "Bash(git -C /Users/jfreeman/Coding/ocr checkout -b docs/branch-discipline main)",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\ndocs: add branch discipline, commit conventions, and session close protocol\n\nCLAUDE.md lacked development workflow rules. All prior commits\nlanded directly on main. Adds feature branch requirement, commit\nmessage format, and session close checklist â€” matching the\nconventions in langlearn-polly-mcp.\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git -C /Users/jfreeman/Coding/ocr push -u origin docs/branch-discipline)",
      "Bash(gh pr create --repo jmf-pobox/quarry-mcp --title \"docs: add branch discipline and development workflow to CLAUDE.md\" --body \"$\\(cat <<''EOF''\n## Summary\n- Add **Branch Discipline** section: feature branches required, never commit to main, branch prefix conventions\n- Add **Micro-Commits** section with commit message format \\(`type\\(scope\\): description`\\)\n- Add **Session Close Protocol** checklist\n- Remove duplicate \"Micro-commits\" bullet from Standards \\(now in its own section\\)\n\nModeled on the conventions already established in langlearn-polly-mcp.\n\n## Test plan\n- [ ] Verify CLAUDE.md renders correctly\n- [ ] Confirm no code changes \\(docs only\\)\n\nðŸ¤– Generated with [Claude Code]\\(https://claude.com/claude-code\\)\nEOF\n\\)\")",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\ndocs: add beads issue tracking section to CLAUDE.md\n\nAddress PR review feedback: bd sync was referenced in the\nsession close protocol without context. Add Issue Tracking\nsection explaining beads, when to use it vs TodoWrite, and\nessential commands.\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git -C /Users/jfreeman/Coding/ocr log v0.2.0..HEAD --oneline)",
      "Bash(git -C /Users/jfreeman/Coding/ocr checkout:*)",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\nchore: release v0.2.1\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git -C /Users/jfreeman/Coding/ocr push -u origin chore/release-0.2.1)",
      "Bash(gh pr create:*)",
      "Bash(git -C /Users/jfreeman/Coding/ocr push origin v0.2.1)",
      "Bash(uv tool install:*)",
      "Bash(quarry doctor:*)",
      "Bash(quarry register:*)",
      "Bash(quarry sync:*)",
      "Bash(quarry list:*)",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\nfix: skip macOS resource fork files and hidden directories during sync\n\ndiscover_files now filters out dotfiles \\(._*, .DS_Store\\), files\ninside hidden directories \\(.Trash, .git\\), and macOS resource forks.\nAdds _is_hidden helper. 10 new tests covering all filtering cases.\n\nFixes 23 of 71 failures from first real-world sync run.\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git -C /Users/jfreeman/Coding/ocr push -u origin fix/skip-dotfiles)",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\nrefactor: simplify _is_hidden with .parts and any\\(\\)\n\nAddress PR review: use tuple of path component strings instead of\nintermediate Path objects from .parents. Reduces allocations during\nlarge directory walks.\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(echo:*)",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\nfix: handle MPO \\(iPhone multi-picture\\) JPEG format\n\nAdd MPO to supported image formats. MPO files are converted to plain\nJPEG before OCR to strip multi-picture metadata. MPO frames are treated\nas alternate camera shots \\(page_count=1\\), not document pages.\n\nFixes 44 ingestion failures on iPhone photos.\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git -C /Users/jfreeman/Coding/ocr push -u origin fix/mpo-jpeg)",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\nfix: apply EXIF orientation before image re-encoding\n\niPhone photos store orientation in EXIF metadata. Re-encoding to\nJPEG/PNG drops this metadata, causing rotated images to reach OCR.\nImageOps.exif_transpose\\(\\) bakes the rotation into pixel data before\nsaving.\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\nfix: handle non-UTF-8 text file encodings\n\nTry UTF-8 first, fall back to latin-1 on UnicodeDecodeError. Latin-1\ndecodes any byte sequence and produces correct results for Western\nEuropean encodings \\(German, French, Spanish\\). Removes UnicodeDecodeError\nfrom the docstring since it is now handled internally.\n\nFixes 5 German text file ingestion failures.\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git -C /Users/jfreeman/Coding/ocr push -u origin fix/non-utf8-encoding)",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\nfix: add CP1252 as intermediate encoding fallback\n\nUTF-8 â†’ CP1252 â†’ Latin-1 chain. CP1252 correctly decodes smart quotes\nand other 0x80-0x9F bytes that Latin-1 maps to C1 control characters.\nUpdated test to verify actual curly quote decoding.\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git pull:*)",
      "Bash(table\" and race to create_table, causing one to fail.\n\nAdd double-checked locking \\(matching the pattern in backends.py\\) so the\nfirst thread to reach the lock creates the table while others wait and\nthen use open_table+add.\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "WebFetch(domain:pypi.org)",
      "Bash(uv pip list:*)",
      "mcp__quarry__list_registrations",
      "Bash(uv pip show:*)",
      "Bash(git -C /Users/jfreeman/Coding/ocr diff -- src/quarry/code_processor.py tests/test_code_processor.py)",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\nfix\\(format\\): address 3 PR review comments on code processor\n\n1. UTF-8 byte offsets: tree-sitter start_byte/end_byte are byte offsets\n   into UTF-8. Slice the encoded bytes, then decode â€” fixes incorrect\n   extraction for non-ASCII source code.\n\n2. Remove \"call\" and \"lexical_declaration\" from _DEFINITION_NODE_TYPES.\n   Top-level function calls \\(setup\\(\\), app.run\\(\\)\\) and JS/TS const/let/var\n   are small statements that should group with imports, not get their\n   own sections.\n\n3. Replace module-level pytest.importorskip with try/except and\n   @needs_treesitter markers. TestSupportedExtensions, TestFallbackSplit,\n   and test_returns_none_when_not_installed now run without tree-sitter.\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\nrefactor\\(format\\): make tree-sitter a required dependency\n\ntree-sitter was optional \\([code] extra\\) with silent fallback to\nblank-line splitting. Users got worse quality results with no\nindication. Move to required dependencies, remove ImportError\nhandling, remove lazy import, delete dead test.\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\ndocs: add source code ingestion to README and fix CHANGELOG\n\nREADME: add source code to intro, \"Why Quarry\", Features, MCP tools\ntable, and architecture diagram. CHANGELOG: remove stale [code]\noptional extra reference \\(tree-sitter is now a required dependency\\).\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "mcp__plugin_github_github__pull_request_read",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\nfix\\(format\\): downgrade unknown grammar log from warning to info\n\nUnsupported tree-sitter grammar is a normal path \\(fallback splitting\\),\nnot an error. Remove exc_info=True to avoid noisy stack traces.\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git -C /Users/jfreeman/Coding/ocr log main..HEAD --oneline)",
      "mcp__plugin_github_github__update_pull_request",
      "mcp__plugin_github_github__merge_pull_request",
      "Bash(git -C /Users/jfreeman/Coding/ocr log v0.2.1..HEAD --oneline)",
      "Bash(git -C /Users/jfreeman/Coding/ocr commit -m \"$\\(cat <<''EOF''\nchore: release v0.3.0\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git -C /Users/jfreeman/Coding/ocr push origin v0.3.0)",
      "mcp__plugin_github_github__get_release_by_tag",
      "Bash(/Users/jfreeman/.local/share/uv/tools/quarry-mcp/bin/python3:*)",
      "Bash(uv tool uninstall:*)",
      "mcp__quarry__register_directory",
      "mcp__quarry__sync_all_registrations",
      "WebFetch(domain:nanonets.com)",
      "WebFetch(domain:mindee.github.io)",
      "WebFetch(domain:deepwiki.com)",
      "WebFetch(domain:www.codesota.com)",
      "WebFetch(domain:modal.com)",
      "WebFetch(domain:toon-beerten.medium.com)",
      "WebFetch(domain:www.koncile.ai)",
      "WebFetch(domain:rapidai.github.io)",
      "WebFetch(domain:pypistats.org)",
      "Bash(source:*)",
      "Bash(pip install:*)",
      "mcp__plugin_github_github__request_copilot_review",
      "mcp__plugin_github_github__add_issue_comment",
      "mcp__plugin_github_github__get_latest_release",
      "Bash(twine upload:*)",
      "mcp__plugin_github_github__create_pull_request",
      "Bash(uv pip compile:*)",
      "Bash(git remote:*)",
      "Bash(git fetch:*)",
      "Bash(git rebase:*)",
      "Bash(tee:*)",
      "Bash(/tmp/quarry-staging/.venv/bin/quarry:*)"
    ]
  }
}
